#!/usr/bin/env python
# -*- encoding: utf-8 -*-

import spidev
from time import sleep

'''
The bead controller needs to receive 24bits of data. 
Each 8Bits is in a group to control the three GRB colors

0x80 ==> 0
0xf8 ==> 1

eg:
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, #R
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, #G
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, #B

If the first line is all 0xf8, the final value is 11111111, 
	indicating that the brightness of G is 0xff, that is, 255.
If the first row is all 0x80, then the final value is 00000000, 
	which means the brightness of G is 0x00, which is 0, and goes out.
'''

class WS2812B:

	def __init__(self, bus, device, speed):

		self.spi = spidev.SpiDev()
		#bus , device
		self.spi.open(bus, device)
		self.spi.max_speed_hz = int(speed * 1000000)
		self.spi.mode = 0b0  # Mode 0 for Rock 5B
		self.spi.xfer([0x00])

		self.led_off = [
			# led1 off
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,

			# led2
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,

			# led3 off
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,

			# led4 off
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,

			# led5 off
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,

			# led6 off
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,

			# led7 off
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,

			# led8 off
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
		]

		self.led_on = [
			# led1 on - RED rgb(255, 0, 0)
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # G = 0
			0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8,  # R = 255
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # B = 0

			# led2 on - GREEN rgb(0, 255, 0)
			0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8,  # G = 255
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # R = 0
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # B = 0

			# led3 on - BLUE rgb(0, 0, 255)
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # G = 0
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # R = 0
			0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8,  # B = 255

			# led4 on - RED rgb(255, 0, 0)
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # G = 0
			0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8,  # R = 255
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # B = 0

			# led5 on - GREEN rgb(0, 255, 0)
			0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8,  # G = 255
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # R = 0
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # B = 0

			# led6 on - BLUE rgb(0, 0, 255)
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # G = 0
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # R = 0
			0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8,  # B = 255

			# led7 on - RED rgb(255, 0, 0)
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # G = 0
			0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8,  # R = 255
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # B = 0

			# led8 on - GREEN rgb(0, 255, 0)
			0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8,  # G = 255
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # R = 0
			0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,  # B = 0
		]

	def light_in_order(self):
		print("light in order")
		a = 0
		x = 24  # Fixed: each LED needs exactly 24 bytes
		while a < 8 :
			self.spi.xfer(self.led_on[0:x:1])
			sleep(1)
			x += 24
			a += 1


	def all_led_off(self):
		sleep(0.5)
		self.spi.xfer(self.led_off)

if __name__ == "__main__" :
	led = WS2812B(0, 0, 8)  # 8 MHz works fine
	led.light_in_order()
	led.all_led_off()
